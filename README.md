# Parking Slot Detection With Lightweight-Keypoint
# Abstract

In this work,we present a light weight parking slot dectection in BEV.  
Based on MoveNet,use a MoblienetV2 as the backbone,and the same fpn structure in MoveNet. We use three detect header,respectively detected the heatmap,the center point of the entrance line and the orientation of the parking slot. Due to  the characteristic of bird eye view,the far object will be obscure but not small,then we remove the offsets branch to save more parameters.    
The whole Parameters of the model is only 0.255M.   
The Precision and the Recall on the ps2.0: 97.63% and 96.77%


Header Detail:      
Header is consist of two 1x1 conv and a dilation conv,the dilation conv is used to extend the field.

We modify the soft wing loss as Weighted soft Wing loss,combined with Weighted SEloss to train the model with 180 epoches.

Heatmap:
We propose a orientation guide heatmap.Different from the traditional method use a circle Gaussian kernel to  the key point heatmap,we use a vector generated by the orientation of the parking line to get a heatmap.

Gaussian kernel:

![image](https://user-images.githubusercontent.com/61531491/165515513-ecc3374a-1eea-4cf6-844e-628782ef40b8.png)

Ours:

![image](https://user-images.githubusercontent.com/61531491/165515671-6f1d95a1-6565-49ec-866a-45f662748480.png)
# Model:
![6f9a268a0009d023a5112b756bc0d1b](https://user-images.githubusercontent.com/61531491/194094570-5dbcf0dd-55b4-48a0-9edc-ee625b18273c.jpg)


# Visualization:

![image](https://user-images.githubusercontent.com/61531491/157662799-3d8935d4-ae07-4f8a-80f4-0bfec716099d.png)
![image](https://user-images.githubusercontent.com/61531491/157663050-a6b96790-c8b9-448a-b72a-d659df829f28.png)
![image](https://user-images.githubusercontent.com/61531491/157663112-d513adc6-28d4-4ce4-892f-96c3fd0ba61d.png)


# Train and Test:
We provide scripts to complete the training and evaluation, before running remember to check the configs in each scripts ^_^:          
`python train.py`       
Evaluation for slot:        
`python evaluate_slot.py`       
Evaluation for each keypiont:       
`python evaluate_point.py`   

Your also can design how to inference the slot by key points ,through rewrite the function `./utils/common/def inference_slots_v2()`
